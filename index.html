<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Forumate v6.1</title>
<style>
:root{--bg:rgba(0,0,0,0.4);--glass:rgba(255,255,255,0.2);--post-bg:rgba(255,255,255,0.12);}
body{margin:0;font-family:'Segoe UI',Tahoma,sans-serif;background:url('wallpaper.png') no-repeat center center fixed;background-size:cover;color:#fff;transition:background 0.3s,color 0.3s;}
body.dark{background:#111;color:#eee;}
body.potato *{transition:none!important;backdrop-filter:none!important;}
#version{position:fixed;bottom:10px;right:15px;color:rgba(255,255,255,0.7);font-size:14px;z-index:1000;}
#updateIndicator{font-size:12px;color:lime;cursor:pointer;margin-left:5px;display:none;}
#adminBtn{display:inline-block;position:fixed;top:15px;right:15px;width:32px;height:32px;border-radius:50%;background:rgba(244,67,54,0.85);color:white;font-weight:bold;font-size:16px;border:none;cursor:pointer;z-index:3100;}
#sidebar{position:fixed;top:0;left:-260px;width:260px;height:100%;background: rgba(50,50,50,0.85);backdrop-filter: blur(15px);padding:50px 20px 20px 20px;box-shadow:2px 0 15px rgba(0,0,0,0.4);transition:left 0.4s;z-index:1500;border-radius:0 12px 12px 0;overflow-y:auto;}
#sidebar.show{left:0;}
#sidebar .sidebar-buttons{opacity:0;transition:opacity 0.3s;}
#sidebar.show .sidebar-buttons{opacity:1;}
#sidebar .sidebar-buttons button{width:100%; margin:10px 0; padding:12px; border-radius:12px; border:none;background: rgba(66,103,178,0.3); color:#fff; font-weight:bold; cursor:pointer; transition:0.3s;}
#sidebar .sidebar-buttons button:hover{background: rgba(66,103,178,0.6);transform: translateX(5px);}
#sidebar .closeBtn{position:absolute;top:10px;right:10px;background:none;color:white;font-size:24px;cursor:pointer;border:none;display:none;z-index:2500;}
#sidebar.show .closeBtn{display:block;}
#hamburger{position:fixed;top:15px;left:15px;font-size:26px;cursor:pointer;z-index:2000;color:white;user-select:none;transition:transform 0.3s;}
#hamburger:hover{transform:scale(1.1);}
main{max-width:700px;margin:140px auto 30px;padding:0 15px;transition:margin-left 0.3s ease;}
input, textarea{width:100%;padding:12px;margin:8px 0;border-radius:12px;border:1px solid rgba(255,255,255,0.3);background: var(--glass);color:#fff;font-size:16px;box-sizing:border-box;resize:none;}
input::placeholder, textarea::placeholder{color: rgba(255,255,255,0.7);}
#postBtn,#reportBugBtn{width:100%;padding:12px;border-radius:12px;border:none;background: rgba(66,103,178,0.8);color:#fff;font-size:16px;cursor:pointer;margin-bottom:10px;transition:0.3s;}
#postBtn:hover,#reportBugBtn:hover{background: rgba(66,103,178,1);transform:scale(1.02);}
.post{background: var(--post-bg);border-radius:14px;padding:16px 20px;margin-bottom:14px;border:1px solid rgba(255,255,255,0.15);opacity:0;animation:fadeInSlide 0.5s forwards;}
.post:hover{transform: scale(1.02);transition: transform 0.2s ease;}
.post img{max-width:100%;border-radius:10px;margin-top:8px;}
.post.pinned{border:2px solid gold;background: rgba(255,215,0,0.15);}
.post .name.owner{color:red;font-weight:bold;}
.post .tag{font-size:12px;color:#4da6ff;margin-left:3px;}
.postMenuBtn{float:right;cursor:pointer;color:#ccc;font-weight:bold;}
#backBtn{display:none;margin-bottom:10px;cursor:pointer;color:#fff;font-weight:bold;background:none;border:none;font-size:16px;}
#loginPopup{display:flex;justify-content:center;align-items:center;position:fixed;top:0;left:0;width:100%;height:100%;background: rgba(0,0,0,0.6);z-index:2700;}
#loginPopup div{background: rgba(50,50,50,0.9);backdrop-filter: blur(12px);padding:20px;border-radius:12px;display:flex;flex-direction:column;min-width:250px;}
#loginPopup input{margin:5px 0;padding:10px;border-radius:10px;border:none;font-size:14px;}
#loginPopup .closeBtn{align-self:flex-end;font-size:18px;cursor:pointer;background:none;border:none;color:white;margin-bottom:5px;}
@keyframes fadeInSlide{from{opacity:0;transform:translateY(15px);}to{opacity:1;transform:translateY(0);}}
@media(max-width:768px){main{margin-top:110px;} input,textarea,#postBtn,#sidebar .sidebar-buttons button,#reportBugBtn{font-size:14px;padding:10px;} #adminBtn{width:28px;height:28px;font-size:14px;top:15px;right:15px;}}
@media(max-width:480px){main{margin-top:90px;} input,textarea,#postBtn,#sidebar .sidebar-buttons button,#reportBugBtn{font-size:13px;padding:8px;} #adminBtn{width:25px;height:25px;font-size:12px;top:15px;right:15px;}}
</style>
</head>
<body>

<button id="adminBtn" onclick="showAdminLogin()">A</button>
<div id="version">v6.1 (Last updated: 2025-10-23) <span id="updateIndicator">⬆</span></div>
<div id="hamburger" onclick="toggleSidebar()">☰</div>

<div id="sidebar">
  <button class="closeBtn" onclick="toggleSidebar()">×</button>
  <div class="sidebar-buttons" id="sidebarButtons">
    <button onclick="toggleDarkMode()">Dark Mode</button>
    <button onclick="togglePotatoMode()">Potato Mode</button>
    <button onclick="showBugForm()">Report a Bug</button>
    <button id="seeBugsBtn" onclick="viewBugs()" style="display:none;">See Bugs</button>
    <div id="adminMenu" style="display:none;">
      <button onclick="resetForum()">Reset Forum</button>
      <button onclick="pinPost()">Make Pinned Post</button>
      <button onclick="logoutAdmin()">Logout Admin</button>
    </div>
    <div id="onlineCount" style="margin-top:15px;color:lime;font-weight:bold;">Online: 0</div>
  </div>
</div>

<div id="loginPopup" style="display:none;">
  <div>
    <button class="closeBtn" onclick="closeAdminLogin()">×</button>
    <h3>Admin Login</h3>
    <input id="loginName" placeholder="Username">
    <input id="loginPass" type="password" placeholder="Password">
    <button onclick="loginAdmin()">Login</button>
  </div>
</div>

<main>
  <button id="backBtn" onclick="backToPosts()">&lt; Back</button>
  <input type="text" id="name" placeholder="Your name">
  <textarea id="message" placeholder="Your message" rows="3"></textarea>
  <input type="text" id="image" placeholder="Image URL (optional)">
  <button id="postBtn" onclick="postMessage()">Post</button>
  <button id="reportBugBtn" style="display:none;" onclick="submitBug()">Submit Bug</button>
  <div id="posts"></div>
</main>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script>
// Firebase config
const firebaseConfig = {apiKey:"AIzaSyA1pylg4PQS_hXhKiLvYcdgh5jbLYhME40",authDomain:"html-test-forum.firebaseapp.com",databaseURL:"https://html-test-forum-default-rtdb.firebaseio.com",projectId:"html-test-forum",storageBucket:"html-test-forum.firebasestorage.app",messagingSenderId:"781492084495",appId:"1:781492084495:web:309c83e29024ba321ba87a",measurementId:"G-H877ZK81ZM"};
firebase.initializeApp(firebaseConfig);
const db=firebase.database();
const postsDiv=document.getElementById('posts');
let isAdmin=false;

// Sidebar
function toggleSidebar(){document.getElementById('sidebar').classList.toggle('show');}

// Dark & Potato Mode
function toggleDarkMode(){document.body.classList.toggle('dark');localStorage.setItem('darkMode',document.body.classList.contains('dark'));}
function togglePotatoMode(){document.body.classList.toggle('potato');localStorage.setItem('potatoMode',document.body.classList.contains('potato'));}
if(localStorage.getItem('darkMode')==='true') document.body.classList.add('dark');
if(localStorage.getItem('potatoMode')==='true') document.body.classList.add('potato');

// Admin login
function showAdminLogin(){document.getElementById('loginPopup').style.display='flex';const lastUser=localStorage.getItem('lastAdminUser');if(lastUser) document.getElementById('loginName').value=lastUser;}
function closeAdminLogin(){document.getElementById('loginPopup').style.display='none';}
function loginAdmin(){
  const user=document.getElementById('loginName').value.trim();
  const pass=document.getElementById('loginPass').value.trim();
  localStorage.setItem('lastAdminUser',user);
  if(user==='melting'&&pass==='melting'){
    isAdmin=true;
    document.getElementById('loginPopup').style.display='none';
    document.getElementById('seeBugsBtn').style.display='block';
    document.getElementById('adminMenu').style.display='block';
    alert('Admin logged in!');
    loadPosts();
  } else alert('Wrong credentials');
}
function logoutAdmin(){isAdmin=false;document.getElementById('seeBugsBtn').style.display='none';document.getElementById('adminMenu').style.display='none';alert('Admin logged out');}

// User IP and persistent number
async function getUserIP(){try{let res=await fetch('https://api.ipify.org?format=json');let data=await res.json();return data.ip;}catch{return 'unknown';}}
async function getUserNumber(ip){const snapshot=await db.ref('ids/'+ip).once('value');let id=snapshot.val();if(!id){id=Math.floor(Math.random()*9000)+1000;db.ref('ids/'+ip).set(id);}return id;}

// Posts
async function postMessage(){
  const name=document.getElementById('name').value.trim();
  const message=document.getElementById('message').value.trim();
  const image=document.getElementById('image').value.trim();
  if(!name||!message) return alert('Name and message required');

  const ip = await getUserIP();
  const number = await getUserNumber(ip);
  const displayName = name + ' <span class="tag">#'+number+'</span>';

  const post={name:displayName,message};
  if(image) post.image=image;
  if(isAdmin){post.admin=true;post.name='OWNER';}
  db.ref('posts').push(post);

  document.getElementById('name').value='';document.getElementById('message').value='';document.getElementById('image').value='';
}

function loadPosts(){
  db.ref('posts').on('value', snapshot => {
    postsDiv.innerHTML='';
    let countOnline=0;
    snapshot.forEach(child => {
      countOnline++;
      const post=child.val();
      const postEl=document.createElement('div');
      postEl.className='post';
      if(post.admin) postEl.classList.add('pinned');
      postEl.innerHTML=`<span class="name ${post.admin?'owner':''}">${post.name}</span>: ${post.message}`;
      if(post.image) postEl.innerHTML+=`<br><img src="${post.image}" />`;
      if(isAdmin) postEl.innerHTML+=`<span class="postMenuBtn" onclick="deletePost('${child.key}')">⋮</span>`;
      postsDiv.appendChild(postEl);
    });
    document.getElementById('onlineCount').innerText='Online: '+countOnline;
  });
}

function deletePost(key){if(isAdmin) db.ref('posts/'+key).remove();}
function resetForum(){if(isAdmin && confirm('Clear all posts?')) db.ref('posts').remove();}
function pinPost(){alert('Select a post and mark it pinned in next version');}

loadPosts();
</script>
</body>
</html>
